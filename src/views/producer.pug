doctype(html)
html
  head
    meta(charset='UTF-8')
    meta(http-equiv='X-UA-Compatible' content='IE=edge')
    meta(name='viewport' content='width=device-width, initial-scale=1.0')
    link(href='https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css' rel='stylesheet' integrity='sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3' crossorigin='anonymous')
    link(rel='stylesheet' href='https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.2/font/bootstrap-icons.css')
    link(rel='stylesheet' href='https://unpkg.com/bootstrap-table@1.21.2/dist/bootstrap-table.min.css')
    link(href='/public/css/styles.css' rel='stylesheet')
    link(href='/public/css/jquery.dataTables.min.css' rel='stylesheet')
    title No Agenda Producer Database - Producer Credits
  body 
  nav.navbar.dark.bg-dark
    .container-fluid
      a.navbar-brand(href='/')
        img.d-inline-block.align-text-top(src='/public/images/na_logo.png' alt='No Agenda Show logo' width='30' height='30')
        |             No Agenda Producer Database
      form.d-flex(role='search' action='/search')
        input.form-control.me-2(type='search' placeholder='producer, episode, date' aria-label='Search')
        button.btn.btn-outline-success(type='submit') Search
  .container
    .row.pt-4
      .container-fluid
        h1 Producer Credits
    .row.pt-4
      .container-fluid
        div(style="text-align: right") 
            button#export-json(class="btn btn-success me-3" type="button") Export JSON
            button#export-csv(class="btn btn-success" type="button") Export CSV 
        div(class="table-responsive")
          table(data-toggle="true" data-search="true" data-search-align="right")
            thead
              tr
                th(data-filter-control='select', data-sortable='true') Producer
                th(data-filter-control='select', data-sortable='true') Type
                th(data-filter-control='select', data-sortable='true') Date
                th(data-filter-control='select', data-sortable='true') Number
                th(data-filter-control='select', data-sortable='true') Title 
            tbody
              each credit in producerCredits
                - const imgSrc = "/art/" + credit.epNum + ".png"
                tr
                  td 
                    a(href="/producer/"+credit.producer) #{credit.producer}
                  td #{credit.credType}
                  td(class="text-end") #{credit.epDate}
                  td
                    a(target="_blank" href="https://noagendashow.net/listen/"+credit.epNum) #{credit.epNum}
                  td(class="text-center")
                    a(target="_blank" href="https://noagendashow.net/listen/"+credit.epNum)
                      img(class="art" src=imgSrc)
                      br
                      span #{credit.epTitle}

    script(src='https://cdn.jsdelivr.net/npm/jquery/dist/jquery.min.js')
    script(src='https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.2.0/papaparse.min.js')
    script(src='https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js' integrity='sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p' crossorigin='anonymous')
    script(src='https://unpkg.com/bootstrap-table@1.21.2/dist/bootstrap-table.min.js')
    script.
      $(document).ready(function() {
          function exportJson(data) {
              var json = JSON.stringify(data);
              var blob = new Blob([json], {type: "application/json"});
              var url = URL.createObjectURL(blob);
              var a = document.createElement('a');
              a.href = url;
              a.download = 'NoAgendaCredits.json';
              a.click();
          }
          
          function exportCsv(data) {
              var csv = Papa.unparse(data);
              var blob = new Blob([csv], {type: "text/csv"});
              var url = URL.createObjectURL(blob);
              var a = document.createElement('a');
              a.href = url;
              a.download = 'NoAgendaCredits.csv'; 
              a.click();
          }
          
          $('table').bootstrapTable();

          $('#export-json').click(function() {
              var data = $('table').bootstrapTable('getData', {useCurrentPage: true});
              exportJson(data);
          });

          $('#export-csv').click(function() {
              var data = $('table').bootstrapTable('getData', {useCurrentPage: true});
              exportCsv(data);
          });   
      });